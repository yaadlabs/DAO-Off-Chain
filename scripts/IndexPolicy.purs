module Scripts.IndexPolicy
  ( unappliedIndexPolicy
  ) where

import Contract.Prelude

import Contract.Monad (Contract, liftContractE)
import Contract.PlutusData (toData)
import Contract.Prim.ByteArray (ByteArray)
import Contract.Scripts
  ( MintingPolicy(PlutusMintingPolicy)
  , PlutusScript
  , applyArgs
  )
import Ctl.Internal.Types.Scripts (plutusV2Script)
import ScriptArguments.Types (IndexNftConfig)
import Scripts.Utils (scriptStringToJson, toJsonBytes')

unappliedIndexPolicy :: IndexNftConfig -> Contract MintingPolicy
unappliedIndexPolicy configParams = do
  appliedIndexPolicy <- liftContractE $ indexMintingPolicyScript `applyArgs`
    [ toData configParams ]
  pure $ PlutusMintingPolicy appliedIndexPolicy

indexMintingPolicyScript :: PlutusScript
indexMintingPolicyScript = plutusV2Script indexPolicyByteArray

indexPolicyByteArray :: ByteArray
indexPolicyByteArray = toJsonBytes' $ scriptStringToJson indexPolicyString

-- Generated policy string
indexPolicyString :: String
indexPolicyString =
  "WQgiAQAAMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMiIjIyUzU1AFIiMjUAUiNQAiIiIiIiIjMzUA0mIyMjMBwzAdSQEeUmVmZXJlbmNlIFVUWE8gc2hvdWxkIGJlIHNwZW50ADM1UzA9IhEiJTNQARNQAwNiITM1AFA7MAQAIzNVMAcDUAUAQAEC4SMwASIzMCEDcAIAEAIjJTM1c0ZuPNQAQNjUBcDYRNXNGbhzUAEDM1AXAzAxNQAQNQDzMBwzAdSRKEV4YWN0bHkgb25lIHZhbGlkIHRva2VuIHNob3VsZCBiZSBtaW50ZWQAMwPSJTNQAQMSITUAIiUzNXNGbjwAgCRUzUAEWIhNQAiJTNQAxUzNXNGbjwAgHhUzNXNGCIACB4IHQgdEQsJgDABgFmYDhmA6kgEjSW5pdGlhbCBpbmRleCBzaG91bGQgYmUgc2V0IHRvIHplcm8AE1c0YHJqAEBoZgOpIS1JbmRleCBORlQgbXVzdCBiZSBzZW50IHRvIHRoZSBJbmRleCB2YWxpZGF0b3IAM1NTUAIDEDQjNQEyMwHQAgASAyIzUBMgMiMwHQAgATAdAwNVM1MzVTMDsiESIlM1ABEAIiEzAFACMzVTAHAzAFAEABAsIlM1NQAiIiMwQSJTNQAQNSITUAIiUzNXNGbjwAgDRUzUAEDkiE1ACIlM1ADETVzRgkAAkQH4mAMAGAGJmBwAEACIAIGIBYsRCagBEREpmoAomYHSmZqAELEKmamBIACQgAixCZghESmagAixEJqAERKZmrmjNx4AQA4qZqYFQAJCACLCYAwAYBQAhELAaExMYEoAIiQAIspmauaMCMwKQARMjIyEjMAEAMAIwFDV0Jq6IwKgA1MzVzRgSGBUACJkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZCRmZmZmZmYAIDACwCgCQCABwBgBIA4AoAYARgXGroTV0QARmYEzriABNXQgAmrogAjMwJAJiABNXQgAmrogAjMCN1xq6EAE1dEAGpmauaMDMwOQARMjIyMhIzABAEACUzNXNGBsYHgAImRkJGYAIAYARgPGroTV0RgeABGYDzrTV0JgdgAixuqNXQmrojA6ADUzNXNGBoYHQAImRkJGYAIAYARgOGroTV0RgdABGYDjrTV0JgcgAixuqNXQmBwACLG6o1dCACauiACMzAdAhdaauhABNXRABGYDgDxq6EAE1dEAEZmAy64Bg1dCACauiACMzAXdcAsauhABNXRABGYCwCRq6EAE1dEAEZgKAHmroQATV0RgVABGYCQBpq6EwKQARY3VGroTAoABFjdUACRCauaM3HgBAAkSmagBCACAqRKZqACAuICpGYAJEpmoAQC4gAgJkpmpmZmZq6QAEgEyATIBMjAYN1oARAJgIEJgMAAgIkZKZmrmjAcABAUFTM1c0YDYAICIsYEBuqABIjIyUzNXNGA8ACIkRAAipmauaMB0AETISIjADAEMAQ1dCYEIAQqZmrmjAcABESIgAhYwIQATdUACRkpmauaMBkwHwARMjISMwAQAwAjAENXQmrojAfACMAw1dCYDwAIsbqgASMlMzVzRgMGA8ACJkZGRkZGRkZGQkZmYAIBIA4AYARmAW641dCauiAEUzNXNGBCACJkJERgBACGroTAkACFTM1c0YEAAImQkRGACAIbrjV0JgSABCpmauaMB8AERIiADFjAkABN1Rq6EAE1dEAEZmAQ64Ac1dCACauiMB8ANTM1c0YDJgPgAiZGQkZgAgBgBGYAoBZq6E1dEYD4ARgFmroTAeABFjdUauhMB0AEWN1QAJEZGSmZq5owGQARMBUwBDV0JgPABCpmauaMBoAEA8WMB4AE3VAAkZmAE651oAJERmA0RGZmqufABIBMjIzAZMwFzAHMCAAEwBjAfABMAQ1dEAGauhACANN1YAJEZgMERmZqrnwASARIzAWMAU1dCAEYAZq6IAIAs3WAAkZGSmZq5owFwARMhIiIwBABTAENXQmAyAEKmZq5owFgARMhIiIwAgBTAFNXQmAyAEKmZq5owFQARMhIiIwAQBTAHNXQmAyAEKmZq5owFAARMhIiIwAwBTdcauhMBkAIWMBkAE3VAAkZGSmZq5ozcOkAYACIkREREAGKmZq5ozcOkAUACIkREREAIKmZq5ozcOkAQACJkZCRERERmACASAQbrTV0Jq6IwGQAzdcauhMBgAIVMzVzRgLAAiZGQkREREZgBAEgEG641dCauiMBkAM3XGroTAYACFTM1c0YCoAImRkJERERGYAwBIBBuuNXQmrojAZADMAQ1dCYDAAQqZmrmjAUABEyEiIiIjAHAIMAQ1dCYDAAQqZmrmjATABEyEiIiIjAFAIMAQ1dCYDAAQsYDAAJuqABIyMlMzVzRgJgAiZGRkZCRGZgAgDACABm601dCauiACN1pq6EAE1dEYDAAZutNXQmAuAEKmZq5owEgARMhIjACADMAQ1dCYC4AQsYC4AJuqABIyMlMzVzRgJAAiYB5uuNXQmAsAEKmZq5owEQARMhIjACADN1xq6EwFgAhYwFgATdUACRkpmauaMA8wFQARMjISMwAQAwAjdaauhNXRGAqAEYAZq6EwFAARY3VAAkZKZmrmjAOMBQAETdcauhMBMAEWN1QAIkACIAIgAkQAIgAiACRABEJEYAQAZEJGYAIAYARCRGACAGRCRGYAIAgAZuHSAANw6QARuHSAENw6QAxGRgAgAkRmAGYAQAQAKq55Vc7"
